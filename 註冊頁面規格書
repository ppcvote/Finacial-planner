# ğŸ“± Ultra Advisor LIFF è¨»å†Šé é¢è¦æ ¼æ›¸

> ç‰ˆæœ¬ï¼šv1.0
> 
> 
> **æ—¥æœŸ**ï¼š2026-01-14
> 
> **ç›®æ¨™**ï¼šç”¨æˆ¶å¾ LINE åŠ å¥½å‹åˆ°å–å¾—å¸³è™Ÿï¼Œ20 ç§’å…§å®Œæˆ
> 

---

## ğŸ“‹ åŸ·è¡Œæ‘˜è¦

| é …ç›® | ç¾ç‹€ | ç›®æ¨™ |
| --- | --- | --- |
| è¨»å†Šæ™‚é–“ | ~60 ç§’ï¼ˆLINE å°è©±å¼ï¼‰ | **20 ç§’ä»¥å…§** |
| ç”¨æˆ¶é«”é©— | æ–‡å­—ä¾†å›ã€å¯†ç¢¼å–®ç¨ç™¼é€ | ä¸€é å¼è¡¨å–®ã€å³æ™‚å›é¥‹ |
| æŠ€è¡“æ¶æ§‹ | LINE Bot Webhook | **LIFF é é¢ + Cloud Function** |

---

## ä¸€ã€ç”¨æˆ¶æµç¨‹è¨­è¨ˆ

### 1.1 æ–°æµç¨‹ï¼ˆLIFF ç‰ˆæœ¬ï¼‰

```
ç”¨æˆ¶åŠ å…¥ LINE OA
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è‡ªå‹•æ¨é€æ­¡è¿è¨Šæ¯  â”‚
â”‚  + ã€Œç«‹å³é–‹é€šã€æŒ‰éˆ• â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ é»æ“ŠæŒ‰éˆ•
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LIFF è¨»å†Šé é¢   â”‚  â† åœ¨ LINE å…§é–‹å•Ÿï¼ˆFull Screenï¼‰
â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å§“åè¼¸å…¥    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Email è¼¸å…¥  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å¯†ç¢¼è¨­å®š    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ¨è–¦ç¢¼(é¸å¡«) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â”‚
â”‚  [ ğŸš€ é–‹å§‹è©¦ç”¨ ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ æäº¤
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloud Function   â”‚
â”‚ - å‰µå»º Auth å¸³è™Ÿ  â”‚
â”‚ - å¯«å…¥ Firestore â”‚
â”‚ - é—œè¯ LINE UID  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æˆåŠŸé é¢       â”‚
â”‚  ã€Œå¸³è™Ÿå·²é–‹é€šï¼ã€ â”‚
â”‚                  â”‚
â”‚ [ ç«‹å³å‰å¾€ç³»çµ± ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

### 1.2 æ™‚é–“åˆ†æ

| æ­¥é©Ÿ | èˆŠæµç¨‹ | æ–°æµç¨‹ |
| --- | --- | --- |
| é–‹å•Ÿé é¢ | - | 2 ç§’ |
| è¼¸å…¥å§“å | - | 3 ç§’ |
| è¼¸å…¥ Email | 10 ç§’ï¼ˆæ‰“å­—+ç™¼é€ï¼‰ | 5 ç§’ |
| è¨­å®šå¯†ç¢¼ | - | 5 ç§’ |
| ç­‰å¾…è™•ç† | 5 ç§’ | 3 ç§’ |
| é–±è®€å¯†ç¢¼ | 10 ç§’ | - |
| **ç¸½è¨ˆ** | **~60 ç§’** | **~18 ç§’** |

---

## äºŒã€LIFF é é¢è¨­è¨ˆ

### 2.1 è¦–è¦ºè¨­è¨ˆï¼ˆç¬¦åˆå“ç‰ŒæŒ‡å—ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â–ˆâ–ˆâ–ˆâ–ˆ  æˆ°æƒ…é»‘èƒŒæ™¯ #050b14  â–ˆâ–ˆâ–ˆâ–ˆ     â”‚
â”‚                                     â”‚
â”‚         â•±â•²                          â”‚
â”‚        â•±  â•²   UA ä¸‰ç·š Logo          â”‚
â”‚       â•±â”€â”€â”€â”€â•²  (å‹•ç•«ï¼šè—â†’ç´…â†’ç´«)       â”‚
â”‚                                     â”‚
â”‚      Ultra Advisor                  â”‚
â”‚      è²¡å‹™é¡§å•çš„ç§˜å¯†æ­¦å™¨               â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ‘¤  ä½ çš„ç¨±å‘¼                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ ä¾‹ï¼šç‹å¤§æ˜            â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  âœ‰ï¸  Emailï¼ˆç™»å…¥å¸³è™Ÿï¼‰       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ example@gmail.com   â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ”  è¨­å®šå¯†ç¢¼ï¼ˆè‡³å°‘ 6 ç¢¼ï¼‰   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢            â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ  æ¨è–¦ç¢¼ï¼ˆé¸å¡«ï¼‰          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ æœ‰æ¨è–¦ç¢¼å¯äº«å„ªæƒ       â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚     ğŸš€ é–‹å§‹ 7 å¤©å…è²»è©¦ç”¨     â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           Strategy Blue æŒ‰éˆ•        â”‚
â”‚           ç™¼å…‰æ•ˆæœ + æ‡¸åœæ”¾å¤§        â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                     â”‚
â”‚  ğŸ“‹ è©¦ç”¨æœŸé–“äº«æœ‰å®Œæ•´åŠŸèƒ½ï¼š           â”‚
â”‚     âœ“ 18 ç¨®å°ˆæ¥­ç†è²¡å·¥å…·             â”‚
â”‚     âœ“ ç„¡é™å®¢æˆ¶æª”æ¡ˆ                  â”‚
â”‚     âœ“ å ±è¡¨åŒ¯å‡ºåŠŸèƒ½                  â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  å·²æœ‰å¸³è™Ÿï¼Ÿ [ç›´æ¥ç™»å…¥]              â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

### 2.2 è¨­è¨ˆè¦ç¯„

**è‰²å½©ç³»çµ±**ï¼š

```css
:root {
  --bg-primary: #050b14;          /* æˆ°æƒ…é»‘ */
  --bg-card: rgba(15, 23, 42, 0.8); /* å¡ç‰‡èƒŒæ™¯ */
  --text-primary: #ffffff;
  --text-secondary: #94a3b8;
  --accent-blue: #4DA3FF;
  --accent-blue-dark: #2E6BFF;
  --accent-amber: #F59E0B;
  --border-color: rgba(77, 163, 255, 0.2);
  --glow-blue: 0 0 20px rgba(77, 163, 255, 0.4);
}

```

**è¼¸å…¥æ¡†æ¨£å¼**ï¼š

```css
.input-field {
  background: rgba(15, 23, 42, 0.6);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  padding: 16px;
  color: white;
  font-size: 16px; /* é˜²æ­¢ iOS ç¸®æ”¾ */
  transition: all 0.3s;
}

.input-field:focus {
  border-color: var(--accent-blue);
  box-shadow: var(--glow-blue);
  outline: none;
}

```

**CTA æŒ‰éˆ•**ï¼š

```css
.btn-primary {
  background: linear-gradient(135deg, #4DA3FF, #2E6BFF);
  color: white;
  padding: 18px 32px;
  border-radius: 14px;
  font-size: 18px;
  font-weight: 700;
  box-shadow: var(--glow-blue);
  transition: all 0.3s;
  width: 100%;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 30px rgba(77, 163, 255, 0.6);
}

.btn-primary:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

```

### 2.3 å‹•ç•«æ•ˆæœ

**Logo é€²å ´å‹•ç•«**ï¼ˆèˆ‡å“ç‰ŒæŒ‡å—ä¸€è‡´ï¼‰ï¼š

```css
/* ä¸‰ç·šä¾åºç¹ªè£½ */
.logo-line-blue { animation: drawLine 0.6s ease-out 0.2s forwards; }
.logo-line-red  { animation: drawLine 0.6s ease-out 0.8s forwards; }
.logo-line-purple { animation: drawLine 0.6s ease-out 1.4s forwards; }

@keyframes drawLine {
  from { stroke-dashoffset: 100; opacity: 0; }
  to { stroke-dashoffset: 0; opacity: 1; }
}

```

**è¡¨å–®å…ƒç´ é€²å ´**ï¼š

```css
.form-group {
  opacity: 0;
  transform: translateY(20px);
  animation: fadeInUp 0.5s ease-out forwards;
}

.form-group:nth-child(1) { animation-delay: 0.3s; }
.form-group:nth-child(2) { animation-delay: 0.4s; }
.form-group:nth-child(3) { animation-delay: 0.5s; }
.form-group:nth-child(4) { animation-delay: 0.6s; }

@keyframes fadeInUp {
  to { opacity: 1; transform: translateY(0); }
}

```

---

## ä¸‰ã€æŠ€è¡“å¯¦ä½œ

### 3.1 LIFF è¨­å®š

**LINE Developers Console**ï¼š

1. å»ºç«‹ LIFF App
2. Endpoint URL: `https://ultra-advisor.tw/liff/register`
3. Scope: `profile`, `openid`
4. å°ºå¯¸: `Full`ï¼ˆå…¨è¢å¹•ï¼‰

**LIFF ID**ï¼š`1234567890-abcdefgh`ï¼ˆéœ€æ›¿æ›å¯¦éš›å€¼ï¼‰

### 3.2 å‰ç«¯ç¨‹å¼ç¢¼çµæ§‹

```
/liff
â”œâ”€â”€ /register
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ styles.css
â”‚   â””â”€â”€ app.js
â”œâ”€â”€ /profile
â”‚   â””â”€â”€ ...
â””â”€â”€ /points
    â””â”€â”€ ...

```

### 3.3 æ ¸å¿ƒç¨‹å¼ç¢¼

**index.html**ï¼š

```html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>é–‹é€š Ultra Advisor è©¦ç”¨</title>
  <link rel="stylesheet" href="styles.css">
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <div id="app">
    <!-- Loading State -->
    <div id="loading" class="loading-screen">
      <div class="logo-animation">
        <svg><!-- UA Logo SVG --></svg>
      </div>
      <p>è¼‰å…¥ä¸­...</p>
    </div>

    <!-- Register Form -->
    <div id="register-form" class="hidden">
      <!-- è¡¨å–®å…§å®¹ -->
    </div>

    <!-- Success State -->
    <div id="success" class="hidden">
      <!-- æˆåŠŸç•«é¢ -->
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>

```

**app.js**ï¼š

```jsx
// ==========================================
// Ultra Advisor LIFF è¨»å†Šé é¢
// ==========================================

const LIFF_ID = 'YOUR_LIFF_ID';
const API_ENDPOINT = 'https://us-central1-grbt-f87fa.cloudfunctions.net/liffRegister';

// ç‹€æ…‹ç®¡ç†
let lineProfile = null;
let isSubmitting = false;

// ==========================================
// LIFF åˆå§‹åŒ–
// ==========================================
async function initializeLiff() {
  try {
    await liff.init({ liffId: LIFF_ID });

    // æª¢æŸ¥æ˜¯å¦åœ¨ LINE å…§é–‹å•Ÿ
    if (!liff.isInClient()) {
      showError('è«‹å¾ LINE æ‡‰ç”¨ç¨‹å¼é–‹å•Ÿæ­¤é é¢');
      return;
    }

    // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
    if (!liff.isLoggedIn()) {
      liff.login();
      return;
    }

    // å–å¾—ç”¨æˆ¶è³‡æ–™
    lineProfile = await liff.getProfile();

    // é å¡«å§“å
    document.getElementById('name').value = lineProfile.displayName || '';

    // é¡¯ç¤ºè¡¨å–®
    hideLoading();
    showForm();

  } catch (error) {
    console.error('LIFF åˆå§‹åŒ–å¤±æ•—:', error);
    showError('ç³»çµ±åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
  }
}

// ==========================================
// è¡¨å–®é©—è­‰
// ==========================================
function validateForm() {
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;

  // æ¸…é™¤èˆŠéŒ¯èª¤
  clearErrors();

  let isValid = true;

  // å§“åé©—è­‰
  if (!name) {
    showFieldError('name', 'è«‹è¼¸å…¥æ‚¨çš„ç¨±å‘¼');
    isValid = false;
  }

  // Email é©—è­‰
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!email) {
    showFieldError('email', 'è«‹è¼¸å…¥ Email');
    isValid = false;
  } else if (!emailRegex.test(email)) {
    showFieldError('email', 'Email æ ¼å¼ä¸æ­£ç¢º');
    isValid = false;
  }

  // å¯†ç¢¼é©—è­‰
  if (!password) {
    showFieldError('password', 'è«‹è¨­å®šå¯†ç¢¼');
    isValid = false;
  } else if (password.length < 6) {
    showFieldError('password', 'å¯†ç¢¼è‡³å°‘éœ€è¦ 6 å€‹å­—å…ƒ');
    isValid = false;
  }

  return isValid;
}

// ==========================================
// æäº¤è¨»å†Š
// ==========================================
async function submitRegistration() {
  if (isSubmitting) return;
  if (!validateForm()) return;

  isSubmitting = true;
  showButtonLoading();

  const formData = {
    name: document.getElementById('name').value.trim(),
    email: document.getElementById('email').value.trim(),
    password: document.getElementById('password').value,
    referralCode: document.getElementById('referral').value.trim(),
    lineUserId: lineProfile.userId,
    lineDisplayName: lineProfile.displayName,
    linePictureUrl: lineProfile.pictureUrl || null
  };

  try {
    const response = await fetch(API_ENDPOINT, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData)
    });

    const result = await response.json();

    if (result.success) {
      showSuccess(result.data);
    } else {
      showFormError(result.error || 'è¨»å†Šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
    }

  } catch (error) {
    console.error('è¨»å†Šå¤±æ•—:', error);
    showFormError('ç¶²è·¯é€£ç·šç•°å¸¸ï¼Œè«‹ç¨å¾Œå†è©¦');
  } finally {
    isSubmitting = false;
    hideButtonLoading();
  }
}

// ==========================================
// UI è¼”åŠ©å‡½æ•¸
// ==========================================
function showFieldError(fieldId, message) {
  const field = document.getElementById(fieldId);
  const errorEl = document.createElement('p');
  errorEl.className = 'field-error';
  errorEl.textContent = message;
  field.parentNode.appendChild(errorEl);
  field.classList.add('input-error');
}

function clearErrors() {
  document.querySelectorAll('.field-error').forEach(el => el.remove());
  document.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));
}

function showFormError(message) {
  const errorBanner = document.getElementById('form-error');
  errorBanner.textContent = message;
  errorBanner.classList.remove('hidden');
}

function showButtonLoading() {
  const btn = document.getElementById('submit-btn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> è™•ç†ä¸­...';
}

function hideButtonLoading() {
  const btn = document.getElementById('submit-btn');
  btn.disabled = false;
  btn.innerHTML = 'ğŸš€ é–‹å§‹ 7 å¤©å…è²»è©¦ç”¨';
}

function showSuccess(data) {
  document.getElementById('register-form').classList.add('hidden');
  document.getElementById('success').classList.remove('hidden');

  // é¡¯ç¤ºç”¨æˆ¶è³‡è¨Š
  document.getElementById('success-name').textContent = data.displayName;
  document.getElementById('success-email').textContent = data.email;
  document.getElementById('success-expire').textContent = data.trialExpireDate;
}

function goToApp() {
  // é—œé–‰ LIFF ä¸¦å°å‘ä¸»æ‡‰ç”¨
  if (liff.isInClient()) {
    liff.closeWindow();
  } else {
    window.location.href = 'https://ultra-advisor.tw';
  }
}

// ==========================================
// åˆå§‹åŒ–
// ==========================================
document.addEventListener('DOMContentLoaded', initializeLiff);

```

### 3.4 Cloud Function

**functions/liffRegister.js**ï¼š

```jsx
const functions = require('firebase-functions');
const admin = require('firebase-admin');
const cors = require('cors')({ origin: true });

/**
 * LIFF è¨»å†Š API
 */
exports.liffRegister = functions.https.onRequest((req, res) => {
  cors(req, res, async () => {
    // åªæ¥å— POST
    if (req.method !== 'POST') {
      return res.status(405).json({ success: false, error: 'Method not allowed' });
    }

    try {
      const { name, email, password, referralCode, lineUserId, lineDisplayName, linePictureUrl } = req.body;

      // é©—è­‰å¿…å¡«æ¬„ä½
      if (!name || !email || !password || !lineUserId) {
        return res.status(400).json({ success: false, error: 'è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½' });
      }

      // é©—è­‰ Email æ ¼å¼
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        return res.status(400).json({ success: false, error: 'Email æ ¼å¼ä¸æ­£ç¢º' });
      }

      // é©—è­‰å¯†ç¢¼é•·åº¦
      if (password.length < 6) {
        return res.status(400).json({ success: false, error: 'å¯†ç¢¼è‡³å°‘éœ€è¦ 6 å€‹å­—å…ƒ' });
      }

      // æª¢æŸ¥ Email æ˜¯å¦å·²å­˜åœ¨
      const existingUser = await admin.auth().getUserByEmail(email).catch(() => null);
      if (existingUser) {
        return res.status(400).json({ success: false, error: 'æ­¤ Email å·²ç¶“è¨»å†Š' });
      }

      // æª¢æŸ¥ LINE User ID æ˜¯å¦å·²ç¶å®š
      const existingLineUser = await admin.firestore()
        .collection('users')
        .where('lineUserId', '==', lineUserId)
        .get();

      if (!existingLineUser.empty) {
        return res.status(400).json({ success: false, error: 'æ­¤ LINE å¸³è™Ÿå·²ç¶å®šå…¶ä»–å¸³æˆ¶' });
      }

      // è™•ç†æ¨è–¦ç¢¼
      let referrerUid = null;
      if (referralCode) {
        const referrerSnapshot = await admin.firestore()
          .collection('users')
          .where('referralCode', '==', referralCode.toUpperCase())
          .get();

        if (!referrerSnapshot.empty) {
          referrerUid = referrerSnapshot.docs[0].id;
        }
      }

      // å‰µå»º Firebase Auth å¸³è™Ÿ
      const userRecord = await admin.auth().createUser({
        email: email,
        password: password,
        displayName: name,
        emailVerified: false,
        disabled: false
      });

      // è¨ˆç®—è©¦ç”¨åˆ°æœŸæ™‚é–“ï¼ˆ7 å¤©å¾Œï¼‰
      const now = admin.firestore.Timestamp.now();
      const trialExpires = admin.firestore.Timestamp.fromMillis(
        now.toMillis() + 7 * 24 * 60 * 60 * 1000
      );

      // ç”Ÿæˆæ¨è–¦ç¢¼
      const myReferralCode = generateReferralCode(name);

      // å¯«å…¥ Firestore
      await admin.firestore().collection('users').doc(userRecord.uid).set({
        email: email,
        displayName: name,
        lineUserId: lineUserId,
        lineDisplayName: lineDisplayName,
        linePictureUrl: linePictureUrl,
        createdAt: now,
        trialExpiresAt: trialExpires,
        subscriptionStatus: 'trial',
        membershipDays: 7,
        points: referrerUid ? 50 : 0, // è¢«æ¨è–¦è€…ç²å¾— 50 é»
        referralCode: myReferralCode,
        referredBy: referrerUid,
        isActive: true,
        isFirstLogin: true, // æ¨™è¨˜é¦–æ¬¡ç™»å…¥ï¼Œéœ€å¼·åˆ¶æ”¹å¯†ç¢¼
        clients: [],
        stats: {
          trialsCompleted: 0,
          hoursSaved: 0
        }
      });

      // å¦‚æœæœ‰æ¨è–¦äººï¼Œçµ¦æ¨è–¦äººåŠ é»æ•¸
      if (referrerUid) {
        const batch = admin.firestore().batch();

        // æ›´æ–°æ¨è–¦äººé»æ•¸
        const referrerRef = admin.firestore().collection('users').doc(referrerUid);
        batch.update(referrerRef, {
          points: admin.firestore.FieldValue.increment(100)
        });

        // è¨˜éŒ„é»æ•¸ç•°å‹•
        const ledgerRef = admin.firestore().collection('pointsLedger').doc();
        batch.set(ledgerRef, {
          uid: referrerUid,
          type: 'EARN_REFERRAL',
          amount: 100,
          relatedUid: userRecord.uid,
          description: `æ¨è–¦ ${name} è¨»å†Š`,
          createdAt: now
        });

        await batch.commit();
      }

      // æ ¼å¼åŒ–åˆ°æœŸæ—¥æœŸ
      const expireDate = new Date(trialExpires.toMillis());
      const expireDateStr = `${expireDate.getFullYear()}/${expireDate.getMonth() + 1}/${expireDate.getDate()}`;

      // å›å‚³æˆåŠŸ
      return res.status(200).json({
        success: true,
        data: {
          uid: userRecord.uid,
          email: email,
          displayName: name,
          trialExpireDate: expireDateStr,
          referralCode: myReferralCode,
          points: referrerUid ? 50 : 0
        }
      });

    } catch (error) {
      console.error('LIFF è¨»å†ŠéŒ¯èª¤:', error);
      return res.status(500).json({
        success: false,
        error: 'ç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦'
      });
    }
  });
});

/**
 * ç”Ÿæˆæ¨è–¦ç¢¼
 */
function generateReferralCode(name) {
  const prefix = name.substring(0, 2).toUpperCase();
  const random = Math.random().toString(36).substring(2, 6).toUpperCase();
  return `${prefix}${random}`;
}

```

---

## å››ã€LINE æ­¡è¿è¨Šæ¯æ›´æ–°

### 4.1 æ–°ç‰ˆæ­¡è¿ Flex Message

ç•¶ç”¨æˆ¶åŠ å…¥ LINE OA æ™‚ï¼Œæ¨é€ä»¥ä¸‹è¨Šæ¯ï¼š

```jsx
const welcomeMessage = {
  type: 'flex',
  altText: 'ğŸ‰ æ­¡è¿åŠ å…¥ Ultra Advisorï¼é»æ“Šé–‹é€šè©¦ç”¨',
  contents: {
    type: 'bubble',
    hero: {
      type: 'image',
      url: 'https://ultra-advisor.tw/images/welcome-banner.png',
      size: 'full',
      aspectRatio: '20:13',
      aspectMode: 'cover'
    },
    body: {
      type: 'box',
      layout: 'vertical',
      contents: [
        {
          type: 'text',
          text: 'æ­¡è¿åŠ å…¥ Ultra Advisor',
          weight: 'bold',
          size: 'xl'
        },
        {
          type: 'text',
          text: 'è²¡å‹™é¡§å•çš„ç§˜å¯†æ­¦å™¨',
          size: 'sm',
          color: '#666666',
          margin: 'md'
        },
        {
          type: 'separator',
          margin: 'lg'
        },
        {
          type: 'box',
          layout: 'vertical',
          margin: 'lg',
          spacing: 'sm',
          contents: [
            {
              type: 'text',
              text: 'ğŸ 7 å¤©å…è²»è©¦ç”¨åŒ…å«ï¼š',
              size: 'sm',
              weight: 'bold'
            },
            {
              type: 'text',
              text: 'âœ“ 18 ç¨®å°ˆæ¥­ç†è²¡å·¥å…·',
              size: 'sm',
              color: '#666666'
            },
            {
              type: 'text',
              text: 'âœ“ ç„¡é™å®¢æˆ¶æª”æ¡ˆ',
              size: 'sm',
              color: '#666666'
            },
            {
              type: 'text',
              text: 'âœ“ å ±è¡¨åŒ¯å‡ºåŠŸèƒ½',
              size: 'sm',
              color: '#666666'
            }
          ]
        }
      ]
    },
    footer: {
      type: 'box',
      layout: 'vertical',
      spacing: 'sm',
      contents: [
        {
          type: 'button',
          style: 'primary',
          height: 'md',
          action: {
            type: 'uri',
            label: 'ğŸš€ ç«‹å³é–‹é€šè©¦ç”¨',
            uri: 'https://liff.line.me/YOUR_LIFF_ID'
          },
          color: '#2E6BFF'
        },
        {
          type: 'button',
          style: 'link',
          height: 'sm',
          action: {
            type: 'uri',
            label: 'å·²æœ‰å¸³è™Ÿï¼Ÿç›´æ¥ç™»å…¥',
            uri: 'https://ultra-advisor.tw/login'
          }
        }
      ]
    }
  }
};

```

---

## äº”ã€æˆåŠŸç•«é¢è¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â–ˆâ–ˆâ–ˆâ–ˆ  æˆ°æƒ…é»‘èƒŒæ™¯ #050b14  â–ˆâ–ˆâ–ˆâ–ˆ     â”‚
â”‚                                     â”‚
â”‚            âœ…                       â”‚
â”‚        (ç¶ è‰²æ‰“å‹¾å‹•ç•«)                â”‚
â”‚                                     â”‚
â”‚      ğŸ‰ å¸³è™Ÿé–‹é€šæˆåŠŸï¼               â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚  ğŸ‘¤ ç‹å¤§æ˜                   â”‚   â”‚
â”‚  â”‚  âœ‰ï¸ example@gmail.com       â”‚   â”‚
â”‚  â”‚  ğŸ“… è©¦ç”¨åˆ°æœŸï¼š2026/01/21     â”‚   â”‚
â”‚  â”‚  ğŸ æ¨è–¦ç¢¼ï¼šWA3K7X           â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  ğŸ’¡ å°æé†’ï¼š                        â”‚
â”‚  é¦–æ¬¡ç™»å…¥æ™‚è«‹ä¿®æ”¹å¯†ç¢¼ä»¥ç¢ºä¿å®‰å…¨       â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚     ğŸš€ ç«‹å³å‰å¾€ç³»çµ±          â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  åˆ†äº«æ¨è–¦ç¢¼çµ¦æœ‹å‹ï¼Œé›™æ–¹éƒ½èƒ½ç²å¾—çå‹µï¼ â”‚
â”‚                                     â”‚
â”‚  [ ğŸ“‹ è¤‡è£½æ¨è–¦ç¢¼ ]  [ ğŸ“¤ åˆ†äº« ]     â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

---

## å…­ã€åŸ·è¡Œæª¢æ ¸æ¸…å–®

### Phase 1ï¼šLIFF è¨­å®šï¼ˆDay 1ï¼‰

- [ ]  LINE Developers Console å»ºç«‹ LIFF App
- [ ]  è¨­å®š Endpoint URL
- [ ]  å–å¾— LIFF ID
- [ ]  è¨­å®š Scopeï¼ˆprofile, openidï¼‰

### Phase 2ï¼šå‰ç«¯é–‹ç™¼ï¼ˆDay 2-3ï¼‰

- [ ]  å»ºç«‹ /liff/register ç›®éŒ„çµæ§‹
- [ ]  å¯¦ä½œ index.html + styles.css
- [ ]  å¯¦ä½œ app.jsï¼ˆLIFF SDK æ•´åˆï¼‰
- [ ]  Logo å‹•ç•«æ•ˆæœ
- [ ]  è¡¨å–®é©—è­‰é‚è¼¯
- [ ]  æˆåŠŸç•«é¢
- [ ]  éŒ¯èª¤è™•ç† UI

### Phase 3ï¼šå¾Œç«¯é–‹ç™¼ï¼ˆDay 4ï¼‰

- [ ]  å»ºç«‹ liffRegister Cloud Function
- [ ]  æ•´åˆ Firebase Auth
- [ ]  æ•´åˆ Firestore
- [ ]  æ¨è–¦ç¢¼é‚è¼¯
- [ ]  é»æ•¸ç™¼æ”¾é‚è¼¯
- [ ]  éƒ¨ç½²æ¸¬è©¦

### Phase 4ï¼šæ•´åˆæ¸¬è©¦ï¼ˆDay 5ï¼‰

- [ ]  LINE OA æ­¡è¿è¨Šæ¯æ›´æ–°
- [ ]  å®Œæ•´æµç¨‹æ¸¬è©¦ï¼ˆæ–°ç”¨æˆ¶ï¼‰
- [ ]  éŒ¯èª¤æƒ…å¢ƒæ¸¬è©¦
- [ ]  æ¨è–¦ç¢¼æµç¨‹æ¸¬è©¦
- [ ]  è·¨è£ç½®æ¸¬è©¦ï¼ˆiOS/Androidï¼‰

### Phase 5ï¼šä¸Šç·šï¼ˆDay 6ï¼‰

- [ ]  æ­£å¼ç’°å¢ƒéƒ¨ç½²
- [ ]  ç›£æ§è¨­å®š
- [ ]  èˆŠæµç¨‹ä¸‹ç·š

---

## ä¸ƒã€é æœŸæ•ˆç›Š

| æŒ‡æ¨™ | æ”¹å–„å‰ | æ”¹å–„å¾Œ | æå‡ |
| --- | --- | --- | --- |
| è¨»å†Šå®Œæˆæ™‚é–“ | 60 ç§’ | 20 ç§’ | **67% â†“** |
| è¨»å†Šè½‰æ›ç‡ | ~40% | ~70% | **75% â†‘** |
| ç”¨æˆ¶é«”é©—è©•åˆ† | 6/10 | 9/10 | **50% â†‘** |
| å®¢æœè©¢å•é‡ | é«˜ | ä½ | **80% â†“** |

---

**è¨­è¨ˆå“²å­¸**ï¼šè®“ç”¨æˆ¶åœ¨æœ€çŸ­æ™‚é–“å…§é«”é©—åˆ°ç”¢å“åƒ¹å€¼ï¼Œè€Œä¸æ˜¯åœ¨è¨»å†Šæµç¨‹ä¸­æµå¤±ã€‚