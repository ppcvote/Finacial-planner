# ğŸ¯ Ultra Advisor ä»»å‹™çœ‹æ¿ç³»çµ±è¦æ ¼æ›¸

> ç‰ˆæœ¬ï¼šv1.0
> 
> 
> **æ—¥æœŸ**ï¼š2026-01-14
> 
> **ç‹€æ…‹**ï¼šå¾…é–‹ç™¼
> 
> **è² è²¬**ï¼šClaude Code
> 

---

## 1. ç³»çµ±æ¦‚è¿°

### 1.1 ç›®æ¨™

å»ºç«‹ä»»å‹™çœ‹æ¿ç³»çµ±ï¼Œé€ééŠæˆ²åŒ–æ©Ÿåˆ¶æå‡ç”¨æˆ¶é»è‘—åº¦ï¼Œå¼•å°ç”¨æˆ¶å®Œæˆé—œéµè¡Œç‚ºä¸¦ç²å¾— UA é»æ•¸çå‹µã€‚

### 1.2 æ ¸å¿ƒç‰¹é»

- å‰å°åƒ…é¡¯ç¤º**ç•¶å‰ä»»å‹™**ï¼ˆç°¡æ½”ä¸ä½”ç©ºé–“ï¼‰
- é»æ“Šä»»å‹™åç¨±**ç›´æ¥è·³è½‰**åˆ°åŸ·è¡Œé é¢
- å¾Œå°å¯**æ–°å¢/ç·¨è¼¯/ç®¡ç†**ä»»å‹™
- å¾Œå°å¯æŸ¥çœ‹**å®Œæˆç‡çµ±è¨ˆ**èˆ‡**å®Œæˆç”¨æˆ¶åå–®**
- ä»¥**è‡ªå‹•é©—è­‰**ç‚ºå„ªå…ˆï¼Œæ¸›å°‘äººå·¥ç¢ºèª

---

## 2. å‰å°è¦æ ¼

### 2.1 é¡¯ç¤ºä½ç½®

- **ä½ç½®**ï¼šå€‹äººå¡ç‰‡ä¸‹æ–¹ï¼Œèˆ‡ã€ŒUA æ¨è–¦å¼•æ“ã€åŒå±¤ç´š
- **å°ºå¯¸**ï¼šèˆ‡ UA æ¨è–¦å¼•æ“å¡ç‰‡ç›¸åŒå¯¬åº¦

### 2.2 UI è¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¸ è¨­å®šå€‹äººé ­åƒ              +20 UA  (2/6) â”‚
â”‚                          [é»æ“Šå‰å¾€ â†’]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

**å…ƒç´ èªªæ˜**ï¼š

| å…ƒç´  | èªªæ˜ |
| --- | --- |
| åœ–ç¤º | ä»»å‹™å°æ‡‰çš„ Emojiï¼ˆå¾Œå°è¨­å®šï¼‰ |
| ä»»å‹™åç¨± | å¯é»æ“Šï¼Œè·³è½‰åˆ°å°æ‡‰æ“ä½œ |
| çå‹µé»æ•¸ | é¡¯ç¤º `+XX UA` |
| é€²åº¦ | é¡¯ç¤º `(å·²å®Œæˆ/ç¸½æ•¸)` |
| é»æ“Šå‰å¾€ | æ•´å€‹å¡ç‰‡å¯é»æ“Š |

### 2.3 é¡¯ç¤ºé‚è¼¯

```
1. å¾ Firestore å–å¾—æ‰€æœ‰å•Ÿç”¨ä¸­çš„ä»»å‹™ï¼ˆisActive: trueï¼‰
2. ä¾åˆ†é¡å„ªå…ˆç´šæ’åºï¼šæ–°æ‰‹ â†’ ç¤¾äº¤ â†’ ç¿’æ…£ â†’ æ¯æ—¥
3. åŒåˆ†é¡å…§ä¾ order æ¬„ä½æ’åº
4. éæ¿¾æ‰ç”¨æˆ¶å·²å®Œæˆçš„ä»»å‹™
5. å–ç¬¬ä¸€ç­†ä½œç‚ºã€Œç•¶å‰ä»»å‹™ã€é¡¯ç¤º
6. è‹¥å…¨éƒ¨å®Œæˆï¼Œé¡¯ç¤ºã€ŒğŸ‰ å·²å®Œæˆæ‰€æœ‰ä»»å‹™ï¼ã€

```

### 2.4 é»æ“Šè¡Œç‚º

| linkType | è¡Œç‚º | ç¯„ä¾‹ |
| --- | --- | --- |
| `modal` | é–‹å•ŸæŒ‡å®š Modal | ç·¨è¼¯å€‹äººè³‡æ–™ Modal |
| `internal` | ç«™å…§è·¯ç”±è·³è½‰ | åˆ‡æ›åˆ°ã€Œæˆ‘çš„å®¢æˆ¶ã€tab |
| `external` | æ–°åˆ†é é–‹å•Ÿå¤–éƒ¨é€£çµ | LINE å®˜æ–¹å¸³è™Ÿé€£çµ |
| `pwa` | é¡¯ç¤º PWA å®‰è£æ•™å­¸ Modal | åŠ å…¥ä¸»ç•«é¢æ•™å­¸ |

### 2.5 æ‰€æœ‰æœƒå“¡å¯è¦‹

- âœ… è©¦ç”¨æœƒå“¡ï¼ˆtrialï¼‰
- âœ… ä»˜è²»æœƒå“¡ï¼ˆpaidï¼‰
- âœ… éæœŸæœƒå“¡ï¼ˆexpiredï¼‰

---

## 3. å¾Œå°è¦æ ¼

### 3.1 æ–°å¢é é¢

**è·¯ç”±**ï¼š`/admin/missions`

**é¸å–®**ï¼šåœ¨å´é‚Šæ¬„æ–°å¢ã€ŒğŸ¯ ä»»å‹™ç®¡ç†ã€

### 3.2 ä»»å‹™åˆ—è¡¨é 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ ä»»å‹™ç®¡ç†                                    [+ æ–°å¢ä»»å‹™]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¯©é¸ï¼š[å…¨éƒ¨ â–¼] [æ–°æ‰‹ä»»å‹™] [ç¤¾äº¤ä»»å‹™] [ç¿’æ…£ä»»å‹™] [æ¯æ—¥ä»»å‹™]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  # â”‚ åœ–ç¤º â”‚ ä»»å‹™åç¨±      â”‚ åˆ†é¡   â”‚ é»æ•¸ â”‚ å®Œæˆç‡      â”‚ ç‹€æ…‹   â”‚ æ“ä½œ          â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  1 â”‚ ğŸ“¸  â”‚ è¨­å®šå€‹äººé ­åƒ  â”‚ æ–°æ‰‹   â”‚ +20  â”‚ 45% (9/20)  â”‚ ğŸŸ¢å•Ÿç”¨ â”‚ [ç·¨è¼¯][çµ±è¨ˆ]  â”‚
â”‚  2 â”‚ ğŸ“  â”‚ è¨­å®šé¡¯ç¤ºåç¨±  â”‚ æ–°æ‰‹   â”‚ +15  â”‚ 60% (12/20) â”‚ ğŸŸ¢å•Ÿç”¨ â”‚ [ç·¨è¼¯][çµ±è¨ˆ]  â”‚
â”‚  3 â”‚ ğŸ’¬  â”‚ åŠ å…¥LINEå®˜æ–¹  â”‚ ç¤¾äº¤   â”‚ +20  â”‚ 30% (6/20)  â”‚ ğŸŸ¢å•Ÿç”¨ â”‚ [ç·¨è¼¯][çµ±è¨ˆ]  â”‚
â”‚  4 â”‚ ğŸ‘¥  â”‚ åŠ å…¥æˆ°å‹ç¤¾ç¾¤  â”‚ ç¤¾äº¤   â”‚ +25  â”‚ 25% (5/20)  â”‚ ğŸŸ¢å•Ÿç”¨ â”‚ [ç·¨è¼¯][çµ±è¨ˆ]  â”‚
â”‚  5 â”‚ ğŸ“±  â”‚ åŠ å…¥ä¸»ç•«é¢    â”‚ ç¿’æ…£   â”‚ +30  â”‚ 15% (3/20)  â”‚ ğŸŸ¢å•Ÿç”¨ â”‚ [ç·¨è¼¯][çµ±è¨ˆ]  â”‚
â”‚  6 â”‚ ğŸ‘¤  â”‚ å»ºç«‹ç¬¬ä¸€ä½å®¢æˆ¶â”‚ ç¿’æ…£   â”‚ +20  â”‚ 40% (8/20)  â”‚ ğŸŸ¢å•Ÿç”¨ â”‚ [ç·¨è¼¯][çµ±è¨ˆ]  â”‚
â”‚  7 â”‚ ğŸ“‹  â”‚ ä½¿ç”¨3æ¬¡æ¥­å‹™å°æŠ„â”‚ç¿’æ…£   â”‚ +15  â”‚ 10% (2/20)  â”‚ ğŸŸ¢å•Ÿç”¨ â”‚ [ç·¨è¼¯][çµ±è¨ˆ]  â”‚
â”‚  8 â”‚ ğŸ“…  â”‚ æ¯æ—¥ç™»å…¥      â”‚ æ¯æ—¥   â”‚ +5   â”‚ --          â”‚ ğŸŸ¢å•Ÿç”¨ â”‚ [ç·¨è¼¯][çµ±è¨ˆ]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

### 3.3 æ–°å¢/ç·¨è¼¯ä»»å‹™ Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœï¸ ç·¨è¼¯ä»»å‹™                              [X]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  ä»»å‹™åç¨± *                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ è¨­å®šå€‹äººé ­åƒ                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  ä»»å‹™èªªæ˜ï¼ˆé¸å¡«ï¼‰                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ä¸Šå‚³ä½ çš„å°ˆæ¥­å½¢è±¡ç…§ï¼Œè®“å®¢æˆ¶æ›´ä¿¡ä»»ä½        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  åœ–ç¤º Emoji *          åˆ†é¡ *                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“¸       â”‚          â”‚ æ–°æ‰‹ä»»å‹™ â–¼       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  çå‹µé»æ•¸ *            æ’åº *                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 20       â”‚          â”‚ 1                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ é€£çµè¨­å®š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
â”‚                                                 â”‚
â”‚  é€£çµé¡å‹ *                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â—‹ Modalï¼ˆé–‹å•Ÿå½ˆçª—ï¼‰                      â”‚   â”‚
â”‚  â”‚ â—‹ Internalï¼ˆç«™å…§è·³è½‰ï¼‰                   â”‚   â”‚
â”‚  â”‚ â—‹ Externalï¼ˆå¤–éƒ¨é€£çµï¼‰                   â”‚   â”‚
â”‚  â”‚ â—‹ PWAï¼ˆå®‰è£æ•™å­¸ï¼‰                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  é€£çµç›®æ¨™ *                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ editProfile                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ğŸ’¡ Modal: editProfile | Internal: clients     â”‚
â”‚     External: https://... | PWA: ä¸éœ€å¡«        â”‚
â”‚                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ é©—è­‰è¨­å®š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
â”‚                                                 â”‚
â”‚  é©—è­‰æ–¹å¼ *                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â—‹ è‡ªå‹•é©—è­‰ï¼ˆæª¢æŸ¥æ¬„ä½å€¼ï¼‰                 â”‚   â”‚
â”‚  â”‚ â—‹ æ‰‹å‹•ç¢ºèªï¼ˆç”¨æˆ¶é»æ“Šã€Œæˆ‘å·²å®Œæˆã€ï¼‰       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  é©—è­‰æ¬„ä½ï¼ˆè‡ªå‹•é©—è­‰æ™‚å¿…å¡«ï¼‰                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ photoURL                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ğŸ’¡ å¯ç”¨æ¬„ä½ï¼šphotoURL, displayName,           â”‚
â”‚     lineUserId, clients(count>=1),             â”‚
â”‚     cheatSheetUsageCount(count>=3)             â”‚
â”‚                                                 â”‚
â”‚  é‡è¤‡é¡å‹ *                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â—‹ ä¸€æ¬¡æ€§ï¼ˆåªèƒ½å®Œæˆä¸€æ¬¡ï¼‰                 â”‚   â”‚
â”‚  â”‚ â—‹ æ¯æ—¥é‡ç½®ï¼ˆæ¯å¤©å¯é‡æ–°å®Œæˆï¼‰             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  å•Ÿç”¨ç‹€æ…‹                                       â”‚
â”‚  [âœ…] å•Ÿç”¨æ­¤ä»»å‹™                                â”‚
â”‚                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    [å–æ¶ˆ]  [å„²å­˜]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

### 3.4 ä»»å‹™çµ±è¨ˆ Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š ã€Œè¨­å®šå€‹äººé ­åƒã€å®Œæˆçµ±è¨ˆ              [X]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  å®Œæˆç‡                                         â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  45% (9/20 äºº)      â”‚
â”‚                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                 â”‚
â”‚  âœ… å·²å®Œæˆç”¨æˆ¶ (9)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ é ­åƒ â”‚ å§“å       â”‚ Email          â”‚ å®Œæˆæ™‚é–“    â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â”‚ ğŸ‘¤  â”‚ ç‹å°æ˜     â”‚ wang@...       â”‚ 01/14 10:23 â”‚
â”‚  â”‚ ğŸ‘¤  â”‚ æå¤§è¯     â”‚ lee@...        â”‚ 01/14 09:15 â”‚
â”‚  â”‚ ğŸ‘¤  â”‚ é™³ç¾ç²     â”‚ chen@...       â”‚ 01/13 18:42 â”‚
â”‚  â”‚ ...                                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  âŒ æœªå®Œæˆç”¨æˆ¶ (11)                    [å±•é–‹ â–¼] â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

---

## 4. è³‡æ–™çµæ§‹

### 4.1 Firestore Collections

### `missions/{missionId}` - ä»»å‹™å®šç¾©

```tsx
interface Mission {
  // åŸºæœ¬è³‡è¨Š
  id: string;                    // æ–‡ä»¶ ID
  title: string;                 // ä»»å‹™åç¨±
  description?: string;          // ä»»å‹™èªªæ˜ï¼ˆé¸å¡«ï¼‰
  icon: string;                  // Emoji åœ–ç¤º
  points: number;                // çå‹µé»æ•¸

  // åˆ†é¡èˆ‡æ’åº
  category: 'onboarding' | 'social' | 'habit' | 'daily';  // åˆ†é¡
  order: number;                 // åŒåˆ†é¡å…§æ’åº

  // é€£çµè¨­å®š
  linkType: 'modal' | 'internal' | 'external' | 'pwa';
  linkTarget: string;            // Modal åç¨± / è·¯ç”± / URL

  // é©—è­‰è¨­å®š
  verificationType: 'auto' | 'manual';
  verificationField?: string;    // è‡ªå‹•é©—è­‰çš„æ¬„ä½
  verificationCondition?: string; // é©—è­‰æ¢ä»¶ï¼ˆå¦‚ 'count>=3'ï¼‰

  // é‡è¤‡è¨­å®š
  repeatType: 'once' | 'daily';  // ä¸€æ¬¡æ€§ / æ¯æ—¥

  // ç‹€æ…‹
  isActive: boolean;             // æ˜¯å¦å•Ÿç”¨

  // æ™‚é–“æˆ³
  createdAt: Timestamp;
  updatedAt: Timestamp;
}

```

**åˆ†é¡å°æ‡‰è¡¨**ï¼š

| category | ä¸­æ–‡åç¨± | å„ªå…ˆç´š |
| --- | --- | --- |
| `onboarding` | æ–°æ‰‹ä»»å‹™ | 1ï¼ˆæœ€é«˜ï¼‰ |
| `social` | ç¤¾äº¤ä»»å‹™ | 2 |
| `habit` | ç¿’æ…£ä»»å‹™ | 3 |
| `daily` | æ¯æ—¥ä»»å‹™ | 4ï¼ˆæœ€ä½ï¼‰ |

### `users/{uid}` - ç”¨æˆ¶è³‡æ–™ï¼ˆæ–°å¢æ¬„ä½ï¼‰

```tsx
interface User {
  // ... ç¾æœ‰æ¬„ä½ ...

  // æ–°å¢ï¼šæ¥­å‹™å°æŠ„ä½¿ç”¨æ¬¡æ•¸è¿½è¹¤
  cheatSheetUsageCount: number;  // é è¨­ 0
}

```

### `users/{uid}/completedMissions/{missionId}` - å®Œæˆè¨˜éŒ„

```tsx
interface CompletedMission {
  missionId: string;
  missionTitle: string;          // å†—é¤˜å­˜å„²ï¼Œæ–¹ä¾¿æŸ¥è©¢
  pointsAwarded: number;
  completedAt: Timestamp;
}

```

### `pointsLedger/{transactionId}` - é»æ•¸è¨˜éŒ„ï¼ˆæ–°å¢é¡å‹ï¼‰

```tsx
interface PointsTransaction {
  uid: string;
  type: 'mission';               // æ–°å¢é¡å‹
  subType: 'onboarding' | 'social' | 'habit' | 'daily';  // å°æ‡‰ä»»å‹™åˆ†é¡
  missionId: string;
  missionTitle: string;
  amount: number;
  balanceAfter: number;
  createdAt: Timestamp;
}

```

---

## 5. é è¨­ä»»å‹™æ¸…å–®

ç³»çµ±åˆå§‹åŒ–æ™‚éœ€å»ºç«‹ä»¥ä¸‹ä»»å‹™ï¼š

| # | ä»»å‹™åç¨± | åœ–ç¤º | åˆ†é¡ | é»æ•¸ | é€£çµé¡å‹ | é€£çµç›®æ¨™ | é©—è­‰æ–¹å¼ | é©—è­‰æ¬„ä½ |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | è¨­å®šå€‹äººé ­åƒ | ğŸ“¸ | onboarding | 20 | modal | editProfile | auto | photoURL |
| 2 | è¨­å®šé¡¯ç¤ºåç¨± | ğŸ“ | onboarding | 15 | modal | editProfile | auto | displayName |
| 3 | å»ºç«‹ç¬¬ä¸€ä½å®¢æˆ¶ | ğŸ‘¤ | onboarding | 20 | internal | clients | auto | clients(count>=1) |
| 4 | åŠ å…¥ LINE å®˜æ–¹å¸³è™Ÿ | ğŸ’¬ | social | 20 | external | https://line.me/R/ti/p/@ultraadvisor | auto | lineUserId |
| 5 | åŠ å…¥ LINE æˆ°å‹ç¤¾ç¾¤ | ğŸ‘¥ | social | 25 | external | https://line.me/ti/g2/9Cca20iCP8J0KrmVRg5GOe1n5dSatYKO8ETTHw?utm_source=invitation&utm_medium=link_copy&utm_campaign=default | manual | - |
| 6 | å°‡ Ultra åŠ å…¥ä¸»ç•«é¢ | ğŸ“± | habit | 30 | pwa | - | manual | - |
| 7 | ä½¿ç”¨ 3 æ¬¡æ¥­å‹™å°æŠ„ | ğŸ“‹ | habit | 15 | internal | tools | auto | cheatSheetUsageCount(count>=3) |
| 8 | æ¯æ—¥ç™»å…¥ | ğŸ“… | daily | 5 | - | - | auto | lastLoginDate(today) |

---

## 6. åŠŸèƒ½æµç¨‹

### 6.1 å‰å°ï¼šä»»å‹™é¡¯ç¤ºæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. é é¢è¼‰å…¥                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å¾ Firestore å–å¾—æ‰€æœ‰ missions       â”‚
â”‚    (where isActive == true)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. å–å¾—ç”¨æˆ¶ completedMissions å­é›†åˆ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. éæ¿¾å·²å®Œæˆçš„ä»»å‹™                      â”‚
â”‚    - once é¡å‹ï¼šå·²å®Œæˆå‰‡éæ¿¾            â”‚
â”‚    - daily é¡å‹ï¼šä»Šæ—¥å·²å®Œæˆå‰‡éæ¿¾       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ä¾å„ªå…ˆç´šæ’åº                          â”‚
â”‚    - å…ˆæŒ‰ category å„ªå…ˆç´š               â”‚
â”‚    - å†æŒ‰ order æ•¸å­—                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. å–ç¬¬ä¸€ç­†é¡¯ç¤ºç‚ºã€Œç•¶å‰ä»»å‹™ã€            â”‚
â”‚    è‹¥ç„¡ä»»å‹™å‰‡é¡¯ç¤ºã€Œå·²å®Œæˆæ‰€æœ‰ä»»å‹™ã€      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

### 6.2 å‰å°ï¼šä»»å‹™å®Œæˆæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ¶é»æ“Šä»»å‹™ / ç³»çµ±è‡ªå‹•åµæ¸¬          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æª¢æŸ¥é©—è­‰æ–¹å¼                          â”‚
â”‚    - autoï¼šæª¢æŸ¥å°æ‡‰æ¬„ä½å€¼               â”‚
â”‚    - manualï¼šç”¨æˆ¶é»ã€Œæˆ‘å·²å®Œæˆã€ç¢ºèª     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. é©—è­‰é€šéï¼Ÿ                            â”‚
â”‚    - å¦ â†’ çµæŸ                          â”‚
â”‚    - æ˜¯ â†’ ç¹¼çºŒ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æª¢æŸ¥æ˜¯å¦å·²å®Œæˆé                      â”‚
â”‚    - once ä¸”å·²å®Œæˆ â†’ çµæŸï¼ˆä¸é‡è¤‡ç™¼é»ï¼‰  â”‚
â”‚    - daily ä¸”ä»Šæ—¥å·²å®Œæˆ â†’ çµæŸ          â”‚
â”‚    - æœªå®Œæˆ â†’ ç¹¼çºŒ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç™¼æ”¾é»æ•¸ï¼ˆTransactionï¼‰              â”‚
â”‚    - æ›´æ–° users/{uid}.points            â”‚
â”‚    - å¯«å…¥ pointsLedger                  â”‚
â”‚    - å¯«å…¥ completedMissions å­é›†åˆ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. é¡¯ç¤ºå®Œæˆå‹•ç•« + Toast é€šçŸ¥            â”‚
â”‚    ã€ŒğŸ‰ ä»»å‹™å®Œæˆï¼ç²å¾— +20 UA é»ã€      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

### 6.3 è‡ªå‹•é©—è­‰è§¸ç™¼æ™‚æ©Ÿ

| é©—è­‰æ¬„ä½ | è§¸ç™¼æ™‚æ©Ÿ |
| --- | --- |
| `photoURL` | ç”¨æˆ¶æ›´æ–°å€‹äººè³‡æ–™æ™‚ |
| `displayName` | ç”¨æˆ¶æ›´æ–°å€‹äººè³‡æ–™æ™‚ |
| `lineUserId` | LINE ç™»å…¥/ç¶å®šæ™‚ |
| `clients(count>=1)` | æ–°å¢å®¢æˆ¶å¾Œ |
| `cheatSheetUsageCount(count>=3)` | é—œé–‰æ¥­å‹™å°æŠ„é¢æ¿æ™‚ï¼ˆéœ€æ–°å¢è¿½è¹¤ï¼‰ |
| `lastLoginDate(today)` | æ¯æ¬¡ç™»å…¥æ™‚ |

---

## 7. æ–°å¢åŠŸèƒ½éœ€æ±‚

### 7.1 æ¥­å‹™å°æŠ„ä½¿ç”¨æ¬¡æ•¸è¿½è¹¤

**ä½ç½®**ï¼šæ‰€æœ‰æœ‰æ¥­å‹™å°æŠ„åŠŸèƒ½çš„å·¥å…·å…ƒä»¶

**é‚è¼¯**ï¼š

```tsx
// ç•¶ç”¨æˆ¶é—œé–‰æ¥­å‹™å°æŠ„é¢æ¿æ™‚
const handleCloseCheatSheet = async () => {
  setShowCheatSheet(false);

  // è¿½è¹¤ä½¿ç”¨æ¬¡æ•¸
  if (user) {
    const userRef = doc(db, 'users', user.uid);
    await updateDoc(userRef, {
      cheatSheetUsageCount: increment(1)
    });
  }
};

```

### 7.2 PWA å®‰è£æ•™å­¸ Modal

**å…ƒä»¶**ï¼š`PWAInstallModal.jsx`

**å…§å®¹**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“± å°‡ Ultra Advisor åŠ å…¥ä¸»ç•«é¢           [X]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  [iOS]  [Android]  [é›»è…¦ç‰ˆ]   â† Tab åˆ‡æ›        â”‚
â”‚                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ iOS å®‰è£æ­¥é©Ÿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚                                                 â”‚
â”‚  1ï¸âƒ£ é»æ“Š Safari åº•éƒ¨ã€Œåˆ†äº«ã€æŒ‰éˆ• ğŸ“¤            â”‚
â”‚     [ç¤ºæ„åœ–]                                    â”‚
â”‚                                                 â”‚
â”‚  2ï¸âƒ£ å‘ä¸‹æ»‘å‹•ï¼Œé»æ“Šã€ŒåŠ å…¥ä¸»ç•«é¢ã€               â”‚
â”‚     [ç¤ºæ„åœ–]                                    â”‚
â”‚                                                 â”‚
â”‚  3ï¸âƒ£ é»æ“Šå³ä¸Šè§’ã€Œæ–°å¢ã€                         â”‚
â”‚     [ç¤ºæ„åœ–]                                    â”‚
â”‚                                                 â”‚
â”‚  âœ… å®Œæˆï¼ç¾åœ¨å¯ä»¥åƒ App ä¸€æ¨£é–‹å•Ÿå›‰            â”‚
â”‚                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  [æˆ‘å·²å®Œæˆ]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

### 7.3 PWA è¨­å®šï¼ˆmanifest.jsonï¼‰

**æª”æ¡ˆ**ï¼š`public/manifest.json`

```json
{
  "name": "Ultra Advisor æˆ°æƒ…å®¤",
  "short_name": "Ultra Advisor",
  "description": "å°ç£æœ€å¼·è²¡å‹™é¡§å•ææ¡ˆè§£æ±ºæ–¹æ¡ˆ",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#0f172a",
  "theme_color": "#0f172a",
  "icons": [
    {
      "src": "/logo-192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/logo-512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}

```

**index.html æ–°å¢**ï¼š

```html
<link rel="manifest" href="/manifest.json">

```

---

## 8. API / Cloud Functions

### 8.1 completeMissionï¼ˆä»»å‹™å®Œæˆè™•ç†ï¼‰

å»ºè­°ä½¿ç”¨ Cloud Function ç¢ºä¿é»æ•¸ç™¼æ”¾çš„åŸå­æ€§ï¼š

```jsx
// functions/index.js

exports.completeMission = functions.https.onCall(async (data, context) => {
  // 1. é©—è­‰ç”¨æˆ¶ç™»å…¥
  if (!context.auth) {
    throw new functions.https.HttpsError('unauthenticated', 'è«‹å…ˆç™»å…¥');
  }

  const uid = context.auth.uid;
  const { missionId } = data;

  // 2. å–å¾—ä»»å‹™è³‡æ–™
  const missionRef = admin.firestore().collection('missions').doc(missionId);
  const missionDoc = await missionRef.get();

  if (!missionDoc.exists) {
    throw new functions.https.HttpsError('not-found', 'ä»»å‹™ä¸å­˜åœ¨');
  }

  const mission = missionDoc.data();

  // 3. æª¢æŸ¥æ˜¯å¦å·²å®Œæˆ
  const completedRef = admin.firestore()
    .collection('users').doc(uid)
    .collection('completedMissions').doc(missionId);

  const completedDoc = await completedRef.get();

  if (mission.repeatType === 'once' && completedDoc.exists) {
    throw new functions.https.HttpsError('already-exists', 'ä»»å‹™å·²å®Œæˆé');
  }

  if (mission.repeatType === 'daily' && completedDoc.exists) {
    const completedAt = completedDoc.data().completedAt.toDate();
    const today = new Date();
    if (completedAt.toDateString() === today.toDateString()) {
      throw new functions.https.HttpsError('already-exists', 'ä»Šæ—¥å·²å®Œæˆ');
    }
  }

  // 4. åŸ·è¡Œäº¤æ˜“ï¼šç™¼æ”¾é»æ•¸ + è¨˜éŒ„å®Œæˆ
  const userRef = admin.firestore().collection('users').doc(uid);

  await admin.firestore().runTransaction(async (transaction) => {
    const userDoc = await transaction.get(userRef);
    const currentPoints = userDoc.data().points || 0;
    const newPoints = currentPoints + mission.points;

    // æ›´æ–°ç”¨æˆ¶é»æ•¸
    transaction.update(userRef, { points: newPoints });

    // è¨˜éŒ„å®Œæˆ
    transaction.set(completedRef, {
      missionId: missionId,
      missionTitle: mission.title,
      pointsAwarded: mission.points,
      completedAt: admin.firestore.FieldValue.serverTimestamp()
    });

    // è¨˜éŒ„é»æ•¸å¸³æœ¬
    const ledgerRef = admin.firestore().collection('pointsLedger').doc();
    transaction.set(ledgerRef, {
      uid: uid,
      type: 'mission',
      subType: mission.category,
      missionId: missionId,
      missionTitle: mission.title,
      amount: mission.points,
      balanceAfter: newPoints,
      createdAt: admin.firestore.FieldValue.serverTimestamp()
    });
  });

  return {
    success: true,
    pointsAwarded: mission.points,
    message: `ğŸ‰ ä»»å‹™å®Œæˆï¼ç²å¾— +${mission.points} UA é»`
  };
});

```

---

## 9. å‰å°å…ƒä»¶è¦æ ¼

### 9.1 MissionCard.tsx

**ä½ç½®**ï¼š`src/components/MissionCard.tsx`

**Props**ï¼š

```tsx
interface MissionCardProps {
  // ç„¡éœ€ propsï¼Œå…§éƒ¨è‡ªè¡Œå–å¾—ç”¨æˆ¶å’Œä»»å‹™è³‡æ–™
}

```

**åŠŸèƒ½**ï¼š

1. ç›£è½ `missions` collectionï¼ˆisActive: trueï¼‰
2. ç›£è½ç”¨æˆ¶ `completedMissions` å­é›†åˆ
3. è¨ˆç®—ä¸¦é¡¯ç¤ºç•¶å‰ä»»å‹™
4. è™•ç†é»æ“Šè·³è½‰é‚è¼¯
5. å‘¼å« `completeMission` Cloud Function

### 9.2 PWAInstallModal.tsx

**ä½ç½®**ï¼š`src/components/PWAInstallModal.tsx`

**Props**ï¼š

```tsx
interface PWAInstallModalProps {
  isOpen: boolean;
  onClose: () => void;
  onComplete: () => void;  // ç”¨æˆ¶é»ã€Œæˆ‘å·²å®Œæˆã€æ™‚
}

```

---

## 10. å¾Œå°å…ƒä»¶è¦æ ¼

### 10.1 Missions.jsx

**ä½ç½®**ï¼š`admin/src/pages/Missions.jsx`

**åŠŸèƒ½**ï¼š

1. ä»»å‹™åˆ—è¡¨ï¼ˆå«ç¯©é¸ã€æ’åºï¼‰
2. æ–°å¢ä»»å‹™ Modal
3. ç·¨è¼¯ä»»å‹™ Modal
4. çµ±è¨ˆ Modalï¼ˆå®Œæˆç‡ + ç”¨æˆ¶åå–®ï¼‰
5. å•Ÿç”¨/åœç”¨åˆ‡æ›
6. æ‹–æ‹½æ’åºï¼ˆå¯é¸ï¼‰

### 10.2 å´é‚Šæ¬„æ›´æ–°

**ä½ç½®**ï¼š`admin/src/components/Layout.jsx`

**æ–°å¢é¸å–®é …**ï¼š

```jsx
{
  key: 'missions',
  icon: <AimOutlined />,
  label: 'ä»»å‹™ç®¡ç†',
  path: '/admin/missions'
}

```

---

## 11. å®‰å…¨è¦å‰‡æ›´æ–°

### Firestore Rules

```jsx
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ä»»å‹™å®šç¾© - æ‰€æœ‰äººå¯è®€ï¼Œåƒ…ç®¡ç†å“¡å¯å¯«
    match /missions/{missionId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // ç”¨æˆ¶å®Œæˆè¨˜éŒ„ - åƒ…æœ¬äººå¯è®€ï¼Œé€é Function å¯«å…¥
    match /users/{uid}/completedMissions/{missionId} {
      allow read: if request.auth.uid == uid;
      allow write: if false;  // åªèƒ½é€é Cloud Function
    }

    // è¼”åŠ©å‡½æ•¸
    function isAdmin() {
      return exists(/databases/$(database)/documents/admins/$(request.auth.uid));
    }
  }
}

```

---

## 12. æ¸¬è©¦æª¢æŸ¥æ¸…å–®

### å‰å°æ¸¬è©¦

- [ ]  ä»»å‹™å¡ç‰‡æ­£ç¢ºé¡¯ç¤ºç•¶å‰ä»»å‹™
- [ ]  é€²åº¦æ•¸å­— (X/Y) æ­£ç¢ºè¨ˆç®—
- [ ]  é»æ“Š Modal é¡å‹ä»»å‹™é–‹å•Ÿæ­£ç¢º Modal
- [ ]  é»æ“Š Internal é¡å‹ä»»å‹™æ­£ç¢ºè·³è½‰
- [ ]  é»æ“Š External é¡å‹ä»»å‹™æ–°åˆ†é é–‹å•Ÿ
- [ ]  é»æ“Š PWA é¡å‹ä»»å‹™é¡¯ç¤ºæ•™å­¸ Modal
- [ ]  è‡ªå‹•é©—è­‰æ­£ç¢ºè§¸ç™¼
- [ ]  æ‰‹å‹•ç¢ºèªæŒ‰éˆ•åŠŸèƒ½æ­£å¸¸
- [ ]  å®Œæˆå‹•ç•«å’Œ Toast é€šçŸ¥æ­£ç¢ºé¡¯ç¤º
- [ ]  é»æ•¸æ­£ç¢ºå¢åŠ 
- [ ]  å·²å®Œæˆä»»å‹™ä¸å†é¡¯ç¤ºï¼ˆonce é¡å‹ï¼‰
- [ ]  æ¯æ—¥ä»»å‹™éš”å¤©é‡ç½®
- [ ]  å…¨éƒ¨å®Œæˆé¡¯ç¤ºã€Œå·²å®Œæˆæ‰€æœ‰ä»»å‹™ã€

### å¾Œå°æ¸¬è©¦

- [ ]  ä»»å‹™åˆ—è¡¨æ­£ç¢ºè¼‰å…¥
- [ ]  ç¯©é¸åŠŸèƒ½æ­£å¸¸
- [ ]  æ–°å¢ä»»å‹™åŠŸèƒ½æ­£å¸¸
- [ ]  ç·¨è¼¯ä»»å‹™åŠŸèƒ½æ­£å¸¸
- [ ]  å•Ÿç”¨/åœç”¨åˆ‡æ›æ­£å¸¸
- [ ]  å®Œæˆç‡çµ±è¨ˆæ­£ç¢º
- [ ]  å®Œæˆç”¨æˆ¶åå–®æ­£ç¢ºé¡¯ç¤º
- [ ]  æœªå®Œæˆç”¨æˆ¶åå–®æ­£ç¢ºé¡¯ç¤º

### é‚Šç•Œæƒ…æ³

- [ ]  æ–°ç”¨æˆ¶ï¼ˆç„¡å®Œæˆè¨˜éŒ„ï¼‰æ­£ç¢ºé¡¯ç¤º
- [ ]  é»æ•¸ç‚º 0 çš„ç”¨æˆ¶æ­£ç¢ºè™•ç†
- [ ]  ç¶²è·¯éŒ¯èª¤æ™‚çš„éŒ¯èª¤è™•ç†
- [ ]  ä¸¦ç™¼å®Œæˆä»»å‹™çš„è™•ç†ï¼ˆTransactionï¼‰

---

## 13. éƒ¨ç½²æ­¥é©Ÿ

```bash
# 1. éƒ¨ç½² Cloud Functions
cd functions
npm install
firebase deploy --only functions:completeMission

# 2. æ›´æ–° Firestore å®‰å…¨è¦å‰‡
firebase deploy --only firestore:rules

# 3. åˆå§‹åŒ–é è¨­ä»»å‹™ï¼ˆåŸ·è¡Œä¸€æ¬¡ï¼‰
node scripts/initMissions.js

# 4. éƒ¨ç½²å‰å°
npm run build
firebase deploy --only hosting

# 5. éƒ¨ç½²å¾Œå°
cd admin
npm run build
firebase deploy --only hosting:admin

```

---

## 14. æ¨è–¦ç´€éŒ„ç®¡ç†ç³»çµ±

### 14.1 æ–°å¢é é¢

**è·¯ç”±**ï¼š`/admin/referrals`

**é¸å–®**ï¼šåœ¨å´é‚Šæ¬„æ–°å¢ã€ŒğŸ”— æ¨è–¦ç´€éŒ„ã€

### 14.2 æ¨è–¦ç´€éŒ„åˆ—è¡¨é 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”— æ¨è–¦ç´€éŒ„                                               ç¸½æ¨è–¦æ•¸ï¼š45     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¯©é¸ï¼š[å…¨éƒ¨ â–¼] [æœ¬æœˆ] [ä¸Šæœˆ] [è‡ªè¨‚æ—¥æœŸ]     æœå°‹ï¼š[________________] ğŸ”    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ¨è–¦äºº           â”‚ è¢«æ¨è–¦äºº         â”‚ ç‹€æ…‹     â”‚ æ¨è–¦æ™‚é–“     â”‚ çå‹µ      â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  ğŸ‘¤ ç‹å°æ˜        â”‚ ğŸ‘¤ æå¤§è¯        â”‚ âœ… å·²è¨»å†Š â”‚ 01/14 10:23 â”‚ +100 UA  â”‚
â”‚     wang@...      â”‚    lee@...       â”‚          â”‚             â”‚           â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  ğŸ‘¤ ç‹å°æ˜        â”‚ ğŸ‘¤ é™³ç¾ç²        â”‚ âœ… å·²è¨»å†Š â”‚ 01/13 18:42 â”‚ +100 UA  â”‚
â”‚     wang@...      â”‚    chen@...      â”‚          â”‚             â”‚           â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  ğŸ‘¤ å¼µå¿—è±ª        â”‚ ğŸ‘¤ æ—å°å®‰        â”‚ â³ å¾…ä»˜æ¬¾ â”‚ 01/12 09:15 â”‚ å¾…ç™¼æ”¾    â”‚
â”‚     chang@...     â”‚    lin@...       â”‚          â”‚             â”‚           â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  ğŸ‘¤ é™³ç¾ç²        â”‚ ğŸ‘¤ é»ƒå¤§æ˜        â”‚ âœ… å·²ä»˜è²» â”‚ 01/10 14:30 â”‚ +100 UA  â”‚
â”‚     chen@...      â”‚    huang@...     â”‚          â”‚             â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

### 14.3 æ¨è–¦çµ±è¨ˆå¡ç‰‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š æ¨è–¦çµ±è¨ˆ                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æœ¬æœˆæ¨è–¦     â”‚   ç´¯è¨ˆæ¨è–¦     â”‚   è½‰æ›ç‡       â”‚   ç™¼æ”¾é»æ•¸    â”‚
â”‚      12       â”‚      45       â”‚     67%       â”‚   4,500 UA   â”‚
â”‚   â†‘3 vsä¸Šæœˆ   â”‚               â”‚   (30/45)     â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

### 14.4 æ¨è–¦äººæ’è¡Œæ¦œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ† æ¨è–¦æ’è¡Œæ¦œï¼ˆæœ¬æœˆï¼‰                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ¥‡ ç‹å°æ˜      8 äºº    +800 UA         â”‚
â”‚  ğŸ¥ˆ é™³ç¾ç²      5 äºº    +500 UA         â”‚
â”‚  ğŸ¥‰ å¼µå¿—è±ª      3 äºº    +300 UA         â”‚
â”‚   4 æ—å°å®‰      2 äºº    +200 UA         â”‚
â”‚   5 é»ƒå¤§æ˜      1 äºº    +100 UA         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

### 14.5 æ¨è–¦ç‹€æ…‹å®šç¾©

| ç‹€æ…‹ | ä»£ç¢¼ | èªªæ˜ | çå‹µç™¼æ”¾ |
| --- | --- | --- | --- |
| âœ… å·²è¨»å†Š | `registered` | è¢«æ¨è–¦äººå®Œæˆè¨»å†Š | âœ… ç™¼æ”¾ |
| â³ å¾…ä»˜æ¬¾ | `pending` | è¢«æ¨è–¦äººè©¦ç”¨ä¸­ | âŒ æš«ä¸ç™¼æ”¾ |
| âœ… å·²ä»˜è²» | `paid` | è¢«æ¨è–¦äººå®Œæˆä»˜è²» | âœ… å·²ç™¼æ”¾ï¼ˆæˆ–åŠ ç¢¼ï¼‰ |
| âŒ å·²éæœŸ | `expired` | è¢«æ¨è–¦äººè©¦ç”¨éæœŸæœªä»˜æ¬¾ | âŒ ä¸ç™¼æ”¾ |

### 14.6 Firestore è³‡æ–™çµæ§‹

### `referrals/{referralId}` - æ¨è–¦ç´€éŒ„

```tsx
interface Referral {
  id: string;

  // æ¨è–¦äººè³‡è¨Š
  referrerId: string;           // æ¨è–¦äºº UID
  referrerEmail: string;        // æ¨è–¦äºº Emailï¼ˆå†—é¤˜ï¼‰
  referrerName: string;         // æ¨è–¦äººåç¨±ï¼ˆå†—é¤˜ï¼‰
  referrerCode: string;         // ä½¿ç”¨çš„æ¨è–¦ç¢¼

  // è¢«æ¨è–¦äººè³‡è¨Š
  refereeId: string;            // è¢«æ¨è–¦äºº UID
  refereeEmail: string;         // è¢«æ¨è–¦äºº Email
  refereeName: string;          // è¢«æ¨è–¦äººåç¨±

  // ç‹€æ…‹
  status: 'registered' | 'pending' | 'paid' | 'expired';

  // çå‹µ
  pointsAwarded: number;        // å·²ç™¼æ”¾é»æ•¸ï¼ˆ0 è¡¨ç¤ºæœªç™¼æ”¾ï¼‰
  pointsAwardedAt?: Timestamp;  // ç™¼æ”¾æ™‚é–“

  // æ™‚é–“æˆ³
  createdAt: Timestamp;         // æ¨è–¦æ™‚é–“
  updatedAt: Timestamp;
}

```

### 14.7 æ¨è–¦ä»»å‹™æ•´åˆï¼ˆé ç•™ï¼‰

æœªä¾†å¯åœ¨ä»»å‹™ç³»çµ±ä¸­æ–°å¢æ¨è–¦é¡ä»»å‹™ï¼š

| ä»»å‹™åç¨± | åˆ†é¡ | é»æ•¸ | é©—è­‰æ–¹å¼ | é©—è­‰æ¢ä»¶ |
| --- | --- | --- | --- | --- |
| æ¨è–¦ç¬¬ 1 ä½å¥½å‹ | social | +100 | auto | referralCount >= 1 |
| æ¨è–¦ç¬¬ 3 ä½å¥½å‹ | social | +200 | auto | referralCount >= 3 |
| æ¨è–¦ç¬¬ 5 ä½å¥½å‹ | social | +300 | auto | referralCount >= 5 |
| æ¨è–¦ç¬¬ 10 ä½å¥½å‹ | social | +500 | auto | referralCount >= 10 |

**ç”¨æˆ¶æ¬„ä½æ–°å¢**ï¼š

```tsx
interface User {
  // ... ç¾æœ‰æ¬„ä½ ...
  referralCount: number;  // æˆåŠŸæ¨è–¦äººæ•¸ï¼ˆè‡ªå‹•æ›´æ–°ï¼‰
}

```

### 14.8 Cloud Functionï¼šæ¨è–¦çå‹µç™¼æ”¾

```jsx
// functions/index.js

// ç•¶æ–°ç”¨æˆ¶è¨»å†Šæ™‚ï¼Œæª¢æŸ¥ä¸¦ç™¼æ”¾æ¨è–¦çå‹µ
exports.onUserCreated = functions.firestore
  .document('users/{uid}')
  .onCreate(async (snap, context) => {
    const newUser = snap.data();
    const referredBy = newUser.referredBy;

    if (!referredBy) return;  // æ²’æœ‰æ¨è–¦äºº

    const uid = context.params.uid;
    const referrerId = referredBy;

    // å»ºç«‹æ¨è–¦ç´€éŒ„
    const referralRef = admin.firestore().collection('referrals').doc();
    const referrerDoc = await admin.firestore().collection('users').doc(referrerId).get();
    const referrerData = referrerDoc.data();

    await referralRef.set({
      referrerId: referrerId,
      referrerEmail: referrerData.email,
      referrerName: referrerData.displayName || '',
      referrerCode: referrerData.referralCode,

      refereeId: uid,
      refereeEmail: newUser.email,
      refereeName: newUser.displayName || '',

      status: 'registered',
      pointsAwarded: 100,  // æ¨è–¦çå‹µ
      pointsAwardedAt: admin.firestore.FieldValue.serverTimestamp(),

      createdAt: admin.firestore.FieldValue.serverTimestamp(),
      updatedAt: admin.firestore.FieldValue.serverTimestamp()
    });

    // ç™¼æ”¾é»æ•¸çµ¦æ¨è–¦äºº
    await admin.firestore().runTransaction(async (transaction) => {
      const referrerRef = admin.firestore().collection('users').doc(referrerId);
      const referrerSnap = await transaction.get(referrerRef);
      const currentPoints = referrerSnap.data().points || 0;
      const currentCount = referrerSnap.data().referralCount || 0;
      const newPoints = currentPoints + 100;

      // æ›´æ–°æ¨è–¦äººé»æ•¸å’Œæ¨è–¦æ•¸
      transaction.update(referrerRef, {
        points: newPoints,
        referralCount: currentCount + 1
      });

      // è¨˜éŒ„é»æ•¸å¸³æœ¬
      const ledgerRef = admin.firestore().collection('pointsLedger').doc();
      transaction.set(ledgerRef, {
        uid: referrerId,
        type: 'referral',
        subType: 'invite_success',
        refereeId: uid,
        refereeEmail: newUser.email,
        amount: 100,
        balanceAfter: newPoints,
        createdAt: admin.firestore.FieldValue.serverTimestamp()
      });
    });

    console.log(`æ¨è–¦çå‹µå·²ç™¼æ”¾ï¼š${referrerId} æ¨è–¦ ${uid}`);
  });

```

### 14.9 å¾Œå°å´é‚Šæ¬„æ›´æ–°

**ä½ç½®**ï¼š`admin/src/components/Layout.jsx`

**æ–°å¢é¸å–®é …**ï¼š

```jsx
{
  key: 'referrals',
  icon: <UsergroupAddOutlined />,
  label: 'æ¨è–¦ç´€éŒ„',
  path: '/admin/referrals'
}

```

### 14.10 Firestore å®‰å…¨è¦å‰‡

```jsx
// æ¨è–¦ç´€éŒ„ - åƒ…ç®¡ç†å“¡å¯è®€å¯«
match /referrals/{referralId} {
  allow read, write: if isAdmin();
}

```

---

## 15. ç‰ˆæœ¬ç´€éŒ„

| ç‰ˆæœ¬ | æ—¥æœŸ | è®Šæ›´å…§å®¹ |
| --- | --- | --- |
| v1.0 | 2026-01-14 | åˆç‰ˆè¦æ ¼æ›¸ |
| v1.1 | 2026-01-14 | æ–°å¢æ¨è–¦ç´€éŒ„ç®¡ç†ç³»çµ± |

---

**æ­¤è¦æ ¼æ›¸ä¾› Claude Code é–‹ç™¼åƒè€ƒï¼Œå¦‚æœ‰ç–‘å•è«‹å›å ±è¨è«–ã€‚**